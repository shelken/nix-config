---
name: postmortem
description:
  生成专业的尸检报告（Postmortem）。用于：(1) 分析 release - 分析上次发布到本次发布之间带有 fix
  字样的 commits，生成事故报告；(2) 分析本次对话 - 分析对话中用户让你纠正的问题，总结经验教训。
---

# Postmortem 尸检报告

生成专业的事故分析报告，帮助团队从错误中学习。

## 报告存放位置

- 目录：`./postmortem/`
- 文件命名：`NNN-简短问题描述.md`（NNN 为三位数序号，如 001、002）
- 标题要求：清晰描述问题本质，宁长勿短

## 触发场景

### 场景一：分析 Release

当用户说"分析 release"或类似指令时：

1. 获取上次 release tag 到当前 HEAD 之间的所有 commits
2. 筛选出 commit message 中包含 `fix` 字样的提交
3. 如果没有 fix 相关的提交，直接告知用户"本次发布没有 fix 相关提交，无需生成报告"
4. 如果有，为每个重要问题生成尸检报告

### 场景二：分析本次对话

当用户说"分析本次对话"或类似指令时：

1. 回顾本次对话中用户指出需要纠正的问题
2. 如果没有纠正，直接告知用户"本次对话没有需要记录的问题"
3. 如果有，生成尸检报告记录经验教训

### 场景三：什么也没说

1. 尝试在`postmortem`目录通过名字，查看是否有当前碰到的问题的类似问题

## 报告模板

```markdown
# [问题标题]

## 基本信息

- **严重级别**：P0/P1/P2/P3（P0 最严重）
- **发现时间**：YYYY-MM-DD
- **修复时间**：YYYY-MM-DD

## 事故概述

简要描述发生了什么问题。

## 原因分析

### 根本原因

描述问题的根本原因。

### 引入问题的 Commits（如适用）

- `commit-hash` - commit message

## 复现步骤

1. 步骤一
2. 步骤二
3. ...

## 修复方案

### 修复描述

描述如何修复的。

### 修复的 Commits（如适用）

- `commit-hash` - commit message

## 经验教训

### 做得好的地方

- ...

### 需要改进的地方

- ...

## 预防措施

为避免此类问题再次发生，应采取以下措施：

1. ...
2. ...
```

## 严重级别定义

- **P0**：系统完全不可用，影响所有用户
- **P1**：核心功能受损，影响大量用户
- **P2**：部分功能异常，影响部分用户
- **P3**：轻微问题，不影响主要功能
